How to Install Keycloak on Windows
----------------------------------

References
----------
https://www.keycloak.org

Assumptions
 A) You have OpenJDK 11 or higher installed


Procedure
---------
 1. Download and Extract Keycloak
    a. Go to https://www.keycloak.org/getting-started/getting-started-zip
    b. Click on the link to download keycloak-26.2.4.zip
       *OR*
       Go to https://github.com/keycloak/keycloak/releases/download/26.2.4/keycloak-26.2.4.zip


    c. Save the file to your Downloads directory

    d. Unzip it
       -- This will create a Downloads/keycloak-26.2.4/

 2. Set the JAVA_HOME
    a. Set the JAVA_HOME to reference a Java JDK 11 or greater
       unix> export JAVA_HOME=/usr/java/jdk-11.0.12
       unix> export PATH=${JAVA_HOME}/bin:$PATH

    b. Verify that the java version is JDK 11
       unix> java -version

       You should see this (if using Oracle Java 11)
		java version "11.0.12" 2021-07-20 LTS
		Java(TM) SE Runtime Environment 18.9 (build 11.0.12+8-LTS-237)
		Java HotSpot(TM) 64-Bit Server VM 18.9 (build 11.0.12+8-LTS-237, mixed mode)


 3. Run it
    unix> cd Downloads\keycloak-26.2.4
    unix> bin\kc.bat start-dev

 4. Create an Admin User
    a. Go to http://localhost:8080
    b. Set the admin user by entering in on the welcome page
       Username:  admin
       password:  admin
       Press "Create"

 5. Create a Realm
    NOTE:  Keycloak includes a single realm, called master. Use this realm only for managing Keycloak and not for managing any applications.
    a. Go to http://localhost:8080/admin/
    b. Enter the admin user/password
    c. In the upper left corner, select Master
       Press "Create Realm"

       Realm Name:  MyRealm
       Press "Create"


 6. Create a user for the "MyRealm"
    a. Click Users
       Or
       Go to http://localhost:8080/admin/master/console/#/MyRealm/users

    b. Press "Create new user"
    c. In the Create user page
       Username:  john.smith
       First name:  John
       Last Name;   Smith

 7. Assign a password to the "john.smith" account
    a. Click on the "Credentials" tab for this user
    b. Press "Set Password"
       Password:  secret
       Temporary:  Off
       Press "Save"

 8. Use the Account Console for "MyRealm"
    a. Go to http://localhost:8080/realms/MyRealm/account

    b. Enter the username of john.smith and password
       -- As a user in the Account Console, you can manage your own account

    c. Press "Sign out"

 9. Secure the application by creating a client
    a. Go to the keycloak admin console or http://localhost:8080/admin
    b. Select "MyRealm"
    c. Press Clients
    d. Press "Create client"
    d. In the "Create Client" page
       Client type:  OpenID Connect
       Client Id:    sf328-webapp
       Press "Next"

       Make sure "Standard flow" is checked
       Press "Next"

	   Press "Save"


How to run keycloak to listen on https://keycloak.docker.internal:8444/
------------------------------------------------------------------------
 1. Create this batch script:  start.kc.ssl.bat

 2. Copy this to it

		REM ####################################################################################################################
		REM # Filename:   start.kc.ssl.bat
		REM #
		REM # Purpose:
		REM #     Run keycloak in SSL mode listening on https://keycloak.docker.internal:8444/
		REM #
		REM # ASSUMPTIONS:
		REM #   1) You ran bin/kc.sh build  (first)
		REM #   2) You have a Java 17 JDK
		REM #   3) You have ni2.docker.internal defined in your /etc/hosts file
		REM #
		REM # NOTES:
		REM #   --https-client-auth=<none|request|required>        "request" means keycloak will also accept requests without a cert but validates cert if it exists
		REM #   --hostname=keycloak.docker.internal                 tells it to listen on the hostname called localhost.localdomain
		REM ####################################################################################################################


		set JAVA_OPTS_APPEND=-Djavax.net.ssl.trustStorePassword=changeit -Djavax.net.ssl.trustStoreType=JKS -Djavax.net.ssl.trustStore=%NI2_PROJECT_PATH%\infrastructure\root-ca\server-certs\cacerts.all

		REM Run keycloak in TLS mode
		bin\kc.bat start    --spi-theme-cache-themes=false   --spi-theme-cache-templates=false --http-enabled=false --https-port=8444 --https-key-store-file=%NI2_PROJECT_PATH%\infrastructure\root-ca\server-certs\keycloak.docker.internal.keystore.jks --https-key-store-type=JKS --https-key-store-password=changeit    --log-level=INFO  --hostname-strict=false --hostname=keycloak.docker.internal

 3. Run it
    TERMINAL> cd Downloads\keycloak-26.2.4
    TERMINAL> start.kc.ssl.bat

 4. Connect to it using TLS
    a. Go to https://keycloak.docker.internal:8444/
